#!/usr/bin/env bash

DaySuffix() {
  case $(date +%d) in
    01|1|21|31) echo "st";;
    02|2|22)    echo "nd";;
    03|3|23)    echo "rd";;
    *)          echo "th";;
  esac
}

post_path="$HOME/gopher/food/log/`date +%Y%m%d`.txt"
if [[ -f $post_path ]] ; then 
  echo "$post_path already exists"

  # Edit post
  vim $post_path
else
  echo "Creating $post_path"
  echo "----------------------------------------" >> "$post_path"
  echo "$(date +"%B %d$(DaySuffix), %Y, %A")"     >> "$post_path"
  echo "----------------------------------------" >> "$post_path"
  echo ""                                         >> "$post_path"
  echo ""                                         >> "$post_path"

  # Write post
  vim $post_path

  # Add entry to food log gophermap
  echo -e "0$(date +%Y-%m-%d, %A)\t$(basename $post_path)\n$(cat "$HOME/gopher/food/log/gophermap")" > "$HOME/gopher/food/log/gophermap"

  # Update Last Updated date in index gophermap
  sed -i "s/.*Last\ Updated:.*/        ==== Last Updated: $(date +"%B %d$(DaySuffix), %Y") ====/" "$HOME/gopher/gophermap"
fi

# Save it in git
pushd "$HOME/gopher" && git add -A && git commit -m "Food Log Updated" && git pull && git push && popd
